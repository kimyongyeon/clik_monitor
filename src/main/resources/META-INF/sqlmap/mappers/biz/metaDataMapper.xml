<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 메타데이터 매퍼 -->
<mapper namespace="clikmonitor.nanet.go.kr.mapper.MetaDataMapper">

    <resultMap id="metaDataMap" type="metaDataVO"></resultMap>
    <resultMap id="metaDataSearchMap" type="metaDataSearchVO"></resultMap>

    <sql id = "h_top">
        <![CDATA[
			SELECT  *
            FROM	(
            		SELECT 	ROWNUM RNUM, ALL_LIST.*
            		FROM  	(
        ]]>
    </sql>

    <sql id = "h_bottom">
        <![CDATA[
							) ALL_LIST
					)
			WHERE  	RNUM  >= #{firstIndex}
	        AND  	RNUM <= #{firstIndex} + #{recordCountPerPage}
	    ]]>
    </sql>

    <sql id = "meta_where">
        AND REGDATE BETWEEN #{startDate} AND #{endDate} -- 최종등록일
        AND REGION like '%' || #{region} || '%' -- 지역
        AND SITENM like '%' || #{siteNm} || '%' -- 사이트명
    </sql>


    <select id="selectMetaExcelExportList" parameterType="metaDataSearchVO" resultMap="metaDataMap">
        SELECT
            ROWNUM NUM-- 번호
            , WEBROBOT_CONTENTS.CATEGORYID
            , (SELECT (SELECT CODE_ID_NM FROM COMMON_CODE WHERE CL_CODE='LMC' AND CODE_ID = BRTC_CODE) AS COMDENM FROM ORGAN, COLGOVER WHERE ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID AND ISVIEW = 'Y' AND LOASM_CODE LIKE WEBROBOT_CONTENTS.REGION || '%' AND ROWNUM = 1) AREA  -- 지역
            , WEBROBOT_CONTENTS.SEEDNM -- 사이트명
            , WEBROBOT_CONTENTS.SEEDID -- 사이트ID
            , WEBROBOT_CONTENTS.SEEDURL -- 사이트URL
            , (SELECT DOCTYPE_NAME	FROM OUTDOCTYPE WHERE DOCTYPE = WEBROBOT_CONTENTS.DOCTYPE) DOCTYPE_NAME -- 자료유형
            , WEBROBOT_CONTENTS.SITENM -- 게시판명
            , WEBROBOT_CONTENTS.URL -- 게시판 URL
            , WEBROBOT_CONTENTS.REGDATE -- 최종등록
        FROM WEBROBOT_CONTENTS
        WHERE WEBROBOT_CONTENTS.CUD_CODE != '3'	AND WEBROBOT_CONTENTS.DOCTYPE != '140'

        <include refid="meta_where" />
    </select>

    <!--메타데이터 목록  -->
    <select id="selectMetaDataPagingList" parameterType="metaDataSearchVO" resultMap="metaDataMap">

        <include refid="h_top" />

        SELECT
            ROWNUM NUM-- 번호
            , WEBROBOT_CONTENTS.CATEGORYID
            , (SELECT (SELECT CODE_ID_NM FROM COMMON_CODE WHERE CL_CODE='LMC' AND CODE_ID = BRTC_CODE) AS COMDENM FROM ORGAN, COLGOVER WHERE ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID AND ISVIEW = 'Y' AND LOASM_CODE LIKE WEBROBOT_CONTENTS.REGION || '%' AND ROWNUM = 1) AREA  -- 지역
            , WEBROBOT_CONTENTS.SEEDNM -- 사이트명
            , WEBROBOT_CONTENTS.SEEDID -- 사이트ID
            , WEBROBOT_CONTENTS.SEEDURL -- 사이트URL
            , (SELECT DOCTYPE_NAME	FROM OUTDOCTYPE WHERE DOCTYPE = WEBROBOT_CONTENTS.DOCTYPE) DOCTYPE_NAME -- 자료유형
            , WEBROBOT_CONTENTS.SITENM -- 게시판명
            , WEBROBOT_CONTENTS.URL -- 게시판 URL
            , WEBROBOT_CONTENTS.REGDATE -- 최종등록
        FROM WEBROBOT_CONTENTS
        WHERE WEBROBOT_CONTENTS.CUD_CODE != '3'	AND WEBROBOT_CONTENTS.DOCTYPE != '140'

        <include refid="meta_where" />

        <include refid="h_bottom" />


    </select>

    <!-- 메타데이터 전체 레코드 수 -->
    <select id="selectMetaDataRecordTotalCount" parameterType="metaDataSearchVO" resultType="int" >

        <![CDATA[
			SELECT
				COUNT(*) AS CNT
			FROM
				WEBROBOT_CONTENTS
			WHERE
				CUD_CODE != '3'
				AND DOCTYPE != '140'
	        	]]>

        <include refid="meta_where" />

    </select>

</mapper>
