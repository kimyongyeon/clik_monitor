<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 통계관리 조회 매퍼 -->
<mapper namespace="clikmonitor.nanet.go.kr.mapper.StatisticsMapper">

    <resultMap id="statisticsMap" type="statisticsVO"></resultMap>


    <sql id = "stat_date_where">
        <if test="startDate == endDate">
            AND LAST_UPDT_DT LIKE #{startDate} || '%' -- 최종등록일
        </if>
        <if test="startDate != endDate">
            AND LAST_UPDT_DT BETWEEN #{startDate} AND #{endDate} -- 최종등록일
        </if>
    </sql>

    <!--의회별 전송 데이터 목록 조회  -->
    <select id="selectRasmblyDataSendList" parameterType="statisticsSearchVO" resultMap="statisticsMap">
    <!--<select id="selectRasmblyDataSendList" parameterType="statisticsSearchVO" resultType="statisticsVO">-->
        <![CDATA[
            SELECT * FROM (
                SELECT /*selectRasmblyDataSendList*/
                    AA.RASMBLY_ID ,
                    AA.RASMBLY_NM , /* 의회명 */
                    A.답변 ,
                    B.APNDX_COUNT  , /* 부록 */
                    C.ASEMBY_COUNT ASEMBY_COUNT, /* 의원 */
                    D.ASEMBY_COUNT ASEMBYACT_COUNT, /* 의원활동 */
                    E.BI_COUNT BI_COUNT, /* 의안 */
                    F.BI_COUNT BIFILE_COUNT, /* 의안파일 */
                    G.BI_COUNTMINTS_COUNT ,
                    H.EST_COUNT , /* 선거구 */
                    I.ITNCASEMBY_COUNTASEMBY_COUNT ,
                    J.MINTS_COUNT , /* 회의록 */
                    K.MTGNM_COUNT , /* 회의명 */
                    L.MTR_COUNT , /* 안건 */
                    M.NUMPR_COUNT , /* 대수 */
                    N.OFCPS_COUNT , /* 의원직위 */
                    O.SESN_COUNT , /* 회기 */
                    P.SPKNG_COUNT /* 발언 */
                FROM
                  COLGOVER AA
        ]]>
                INNER JOIN ORGAN
                ON ORGAN.LOASM_CODE = AA.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS 답변 		FROM MINUTES_ANSWER WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) A
                ON AA.RASMBLY_ID = A.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS APNDX_COUNT 		FROM MINUTES_APPENDIX WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />  	GROUP BY RASMBLY_ID) B
                ON AA.RASMBLY_ID = B.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ASEMBY_COUNT 		FROM LAMAN WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" /> 				GROUP BY RASMBLY_ID) C
                ON AA.RASMBLY_ID = C.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ASEMBY_COUNT 	FROM LAMAN_ACTIVITY WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) D
                ON AA.RASMBLY_ID = D.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNT 		FROM BILL WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" />				GROUP BY RASMBLY_ID) E
                ON AA.RASMBLY_ID = E.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNT 	FROM BILL_ATTACH WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" />		GROUP BY RASMBLY_ID) F
                ON AA.RASMBLY_ID = F.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNTMINTS_COUNT  FROM BILL_MINUTES WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) G
                ON AA.RASMBLY_ID = G.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS EST_COUNT 	FROM COLGOVER_EDISTRICT WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />  GROUP BY RASMBLY_ID) H
                ON AA.RASMBLY_ID = H.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ITNCASEMBY_COUNTASEMBY_COUNT 	FROM BILL_PROPO_AMAN WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) I
                ON AA.RASMBLY_ID = I.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MINTS_COUNT 	FROM MINUTES WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" /> 			GROUP BY RASMBLY_ID) J
                ON AA.RASMBLY_ID = J.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MTGNM_COUNT 	FROM SCOMMIT WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />	 		GROUP BY RASMBLY_ID) K
                ON AA.RASMBLY_ID = K.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MTR_COUNT 		FROM ITEM WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" /> 			GROUP BY RASMBLY_ID) L
                ON AA.RASMBLY_ID = L.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS NUMPR_COUNT 		FROM GENER WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" />				GROUP BY RASMBLY_ID) M
                ON AA.RASMBLY_ID = M.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS OFCPS_COUNT 		FROM POSITION WHERE CNTC_INPUT_SE_CODE = 'API'	<include refid="stat_date_where" /> 		GROUP BY RASMBLY_ID) N
                ON AA.RASMBLY_ID = N.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS SESN_COUNT 		FROM COLG_SESSION WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) O
                ON AA.RASMBLY_ID = O.RASMBLY_ID
                LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS SPKNG_COUNT 		FROM MINUTES_STATEMENT WHERE CNTC_INPUT_SE_CODE = 'API'  <include refid="stat_date_where" />	GROUP BY RASMBLY_ID) P
                ON AA.RASMBLY_ID = P.RASMBLY_ID
                ORDER BY ORDR ASC
            ) WHERE 1 = 1

        <if test="keyWordSub == 1"> <!-- 기관유형 -->
            <if test="brtcCode == 'intsttcl_000024'"> <!-- 기초 -->
                AND SUBSTR(RASMBLY_ID,1,6) IN (
                    SELECT LOASM_CODE AS LOASMCODE
                    FROM ORGAN, COLGOVER
                    WHERE INSTT_CL_CODE = 'INTSTTCL_000024'
                    AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
            <if test="brtcCode == 'intsttcl_000023'"> <!-- 광역 -->
                AND SUBSTR(RASMBLY_ID,1,6) IN (
                    SELECT LOASM_CODE AS LOASMCODE
                    FROM ORGAN, COLGOVER
                    WHERE INSTT_CL_CODE != 'INTSTTCL_000024'
                    AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
        </if>
        <if test="keyWordSub == 2"> <!-- 지역 -->
          AND RASMBLY_ID LIKE #{insttClCode} || '%'
        </if>
        <if test="keyWordSub == 3"> <!-- 지방의회 -->
            AND RASMBLY_ID = #{loasmCode}
        </if>

    </select>
    <!--의회별 전송 데이터 목록 엑셀저장  -->
    <select id="selectRasmblyDataSendExcelExportList" parameterType="statisticsSearchVO" resultMap="statisticsMap">
         <![CDATA[
             SELECT * FROM (
                 SELECT /*selectRasmblyDataSendExcelExportList*/
                        AA.RASMBLY_ID ,
                        AA.RASMBLY_NM ,
                        A.답변 ,
                        B.APNDX_COUNT  ,
                        C.ASEMBY_COUNT ASEMBY_COUNT,
                        D.ASEMBY_COUNT ASEMBYACT_COUNT,
                        E.BI_COUNT BI_COUNT,
                        F.BI_COUNT BIFILE_COUNT,
                        G.BI_COUNTMINTS_COUNT ,
                        H.EST_COUNT ,
                        I.ITNCASEMBY_COUNTASEMBY_COUNT ,
                        J.MINTS_COUNT ,
                        K.MTGNM_COUNT ,
                        L.MTR_COUNT ,
                        M.NUMPR_COUNT ,
                        N.OFCPS_COUNT ,
                        O.SESN_COUNT ,
                        P.SPKNG_COUNT
                    FROM
                      COLGOVER AA
         ]]>
                    INNER JOIN ORGAN
                    ON ORGAN.LOASM_CODE = AA.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS 답변 		FROM MINUTES_ANSWER WHERE CNTC_INPUT_SE_CODE = 'API'<include refid="stat_date_where" />	GROUP BY RASMBLY_ID) A
                    ON AA.RASMBLY_ID = A.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS APNDX_COUNT 		FROM MINUTES_APPENDIX WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" /> 	GROUP BY RASMBLY_ID) B
                    ON AA.RASMBLY_ID = B.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ASEMBY_COUNT 		FROM LAMAN WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />				GROUP BY RASMBLY_ID) C
                    ON AA.RASMBLY_ID = C.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ASEMBY_COUNT 	FROM LAMAN_ACTIVITY WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />	GROUP BY RASMBLY_ID) D
                    ON AA.RASMBLY_ID = D.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNT 		FROM BILL WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />			GROUP BY RASMBLY_ID) E
                    ON AA.RASMBLY_ID = E.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNT 	FROM BILL_ATTACH WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />		GROUP BY RASMBLY_ID) F
                    ON AA.RASMBLY_ID = F.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS BI_COUNTMINTS_COUNT  FROM BILL_MINUTES WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />	GROUP BY RASMBLY_ID) G
                    ON AA.RASMBLY_ID = G.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS EST_COUNT 	FROM COLGOVER_EDISTRICT WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" /> GROUP BY RASMBLY_ID) H
                    ON AA.RASMBLY_ID = H.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS ITNCASEMBY_COUNTASEMBY_COUNT 	FROM BILL_PROPO_AMAN WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />	GROUP BY RASMBLY_ID) I
                    ON AA.RASMBLY_ID = I.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MINTS_COUNT 	FROM MINUTES WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />		GROUP BY RASMBLY_ID) J
                    ON AA.RASMBLY_ID = J.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MTGNM_COUNT 	FROM SCOMMIT WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />		GROUP BY RASMBLY_ID) K
                    ON AA.RASMBLY_ID = K.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS MTR_COUNT 		FROM ITEM WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />			GROUP BY RASMBLY_ID) L
                    ON AA.RASMBLY_ID = L.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS NUMPR_COUNT 		FROM GENER WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />			GROUP BY RASMBLY_ID) M
                    ON AA.RASMBLY_ID = M.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS OFCPS_COUNT 		FROM POSITION WHERE CNTC_INPUT_SE_CODE = 'API'	<include refid="stat_date_where" />		GROUP BY RASMBLY_ID) N
                    ON AA.RASMBLY_ID = N.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS SESN_COUNT 		FROM COLG_SESSION WHERE CNTC_INPUT_SE_CODE = 'API' 	<include refid="stat_date_where" />	GROUP BY RASMBLY_ID) O
                    ON AA.RASMBLY_ID = O.RASMBLY_ID
                    LEFT JOIN (SELECT RASMBLY_ID, COUNT(*) AS SPKNG_COUNT 		FROM MINUTES_STATEMENT WHERE CNTC_INPUT_SE_CODE = 'API' <include refid="stat_date_where" />	GROUP BY RASMBLY_ID) P
                    ON AA.RASMBLY_ID = P.RASMBLY_ID
                ORDER BY ORDR ASC
                ) WHERE 1 = 1

            <if test="keyWordSub == 1"> <!-- 기관유형 -->
                <if test="brtcCode == 'intsttcl_000024'"> <!-- 기초 -->
                    AND SUBSTR(RASMBLY_ID,1,6) IN (
                    SELECT LOASM_CODE AS LOASMCODE
                    FROM ORGAN, COLGOVER
                    WHERE INSTT_CL_CODE = 'INTSTTCL_000024'
                    AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                    )
                </if>
                <if test="brtcCode == 'intsttcl_000023'"> <!-- 광역 -->
                    AND SUBSTR(RASMBLY_ID,1,6) IN (
                    SELECT LOASM_CODE AS LOASMCODE
                    FROM ORGAN, COLGOVER
                    WHERE INSTT_CL_CODE != 'INTSTTCL_000024'
                    AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                    )
                </if>
            </if>
            <if test="keyWordSub == 2"> <!-- 지역 -->
                AND RASMBLY_ID LIKE #{insttClCode} || '%'
            </if>
            <if test="keyWordSub == 3"> <!-- 지방의회 -->
                AND RASMBLY_ID = #{loasmCode}
            </if>
    </select>
    <!--항목별 최종전송 데이터 목록 조회 -->
    <select id="selectRasmblyLastSendDataList" parameterType="statisticsSearchVO" resultMap="statisticsMap">
        <![CDATA[
        SELECT /*selectRasmblyLastSendDataList*/
              (SELECT LOASM_NM	FROM ORGAN WHERE ORGAN.LOASM_CODE = CC.RASMBLY_ID) rasmblyNm
            , SUBSTR(MAX(UP1),1,4) || '-' || SUBSTR(MAX(UP1),5,2) || '-' || SUBSTR(MAX(UP1),7,2) || ' ' || SUBSTR(MAX(UP1),9,2) || ':' || SUBSTR(MAX(UP1),11,2) || ':' || SUBSTR(MAX(UP1),13,2) billMinutesFrstRegistDt
            , SUBSTR(MAX(UP2),1,4) || '-' || SUBSTR(MAX(UP2),5,2) || '-' || SUBSTR(MAX(UP2),7,2) || ' ' || SUBSTR(MAX(UP2),9,2) || ':' || SUBSTR(MAX(UP2),11,2) || ':' || SUBSTR(MAX(UP2),13,2) itemFrstRegistDt
            , SUBSTR(MAX(UP3),1,4) || '-' || SUBSTR(MAX(UP3),5,2) || '-' || SUBSTR(MAX(UP3),7,2) || ' ' || SUBSTR(MAX(UP3),9,2) || ':' || SUBSTR(MAX(UP3),11,2) || ':' || SUBSTR(MAX(UP3),13,2) billFrstRegistDt
            , SUBSTR(MAX(UP4),1,4) || '-' || SUBSTR(MAX(UP4),5,2) || '-' || SUBSTR(MAX(UP4),7,2) || ' ' || SUBSTR(MAX(UP4),9,2) || ':' || SUBSTR(MAX(UP4),11,2) || ':' || SUBSTR(MAX(UP4),13,2) minutesAppendixFrstRegistDt
            , SUBSTR(MAX(UP5),1,4) || '-' || SUBSTR(MAX(UP5),5,2) || '-' || SUBSTR(MAX(UP5),7,2) || ' ' || SUBSTR(MAX(UP5),9,2) || ':' || SUBSTR(MAX(UP5),11,2) || ':' || SUBSTR(MAX(UP5),13,2) billFrstRegistDt
            , SUBSTR(MAX(UP6),1,4) || '-' || SUBSTR(MAX(UP6),5,2) || '-' || SUBSTR(MAX(UP6),7,2) || ' ' || SUBSTR(MAX(UP6),9,2) || ':' || SUBSTR(MAX(UP6),11,2) || ':' || SUBSTR(MAX(UP6),13,2) minutesStatementFrstRegistDt
            , CC.RASMBLY_ID rasmblyNmNo
        FROM (
            SELECT AA.RASMBLY_ID, UP1, UP2, UP3, UP4, UP5, UP6 FROM
               (SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP1  FROM MINUTES WHERE CNTC_INPUT_SE_CODE = 'API'   GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) AA -- 회의록
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP2 FROM ITEM WHERE CNTC_INPUT_SE_CODE = 'API'   GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) BB -- 안건
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP3 FROM MINUTES_ANSWER WHERE CNTC_INPUT_SE_CODE = 'API'   GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) CC -- 답변
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP4 FROM MINUTES_APPENDIX WHERE CNTC_INPUT_SE_CODE = 'API'   GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) DD -- 부록
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP5 FROM BILL WHERE CNTC_INPUT_SE_CODE = 'API' GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) EE -- 의안
         	  ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP6 FROM MINUTES_STATEMENT WHERE CNTC_INPUT_SE_CODE = 'API'   GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) FF -- 발언
                WHERE AA.RASMBLY_ID = BB.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = CC.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = DD.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = EE.RASMBLY_ID(+)
                 AND AA.RASMBLY_ID = FF.RASMBLY_ID(+)
            )BB, COLGOVER CC WHERE 1 = 1
		]]>
        <if test="keyWordSub == 1"> <!-- 기관유형 -->
            <if test="brtcCode == 'intsttcl_000024'"> <!-- 기초 -->
                AND SUBSTR(CC.RASMBLY_ID,1,6) IN (
                SELECT LOASM_CODE AS LOASMCODE
                FROM ORGAN, COLGOVER
                WHERE INSTT_CL_CODE = 'INTSTTCL_000024'
                AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
            <if test="brtcCode == 'intsttcl_000023'"> <!-- 광역 -->
                AND SUBSTR(CC.RASMBLY_ID,1,6) IN (
                SELECT LOASM_CODE AS LOASMCODE
                FROM ORGAN, COLGOVER
                WHERE INSTT_CL_CODE != 'INTSTTCL_000024'
                AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
        </if>
        <if test="keyWordSub == 2"> <!-- 지역 -->
            AND CC.RASMBLY_ID LIKE #{insttClCode} || '%'
        </if>
        <if test="keyWordSub == 3"> <!-- 지방의회 -->
            AND CC.RASMBLY_ID = #{loasmCode}
        </if>
        GROUP BY CC.RASMBLY_ID,CC.ORDR	ORDER BY CC.ORDR ASC
    </select>

    <!--항목별 최종전송 데이터 목록 엑셀저장  -->
    <select id="selectRasmblyLastSendDataExcelExportList" parameterType="statisticsSearchVO" resultMap="statisticsMap">
        <![CDATA[
        SELECT /*selectRasmblyLastSendDataExcelExportList*/
             (SELECT LOASM_NM	FROM ORGAN WHERE ORGAN.LOASM_CODE = CC.RASMBLY_ID) rasmblyNm
            , SUBSTR(MAX(UP1),1,4) || '-' || SUBSTR(MAX(UP1),5,2) || '-' || SUBSTR(MAX(UP1),7,2) || ' ' || SUBSTR(MAX(UP1),9,2) || ':' || SUBSTR(MAX(UP1),11,2) || ':' || SUBSTR(MAX(UP1),13,2) billMinutesFrstRegistDt
            , SUBSTR(MAX(UP2),1,4) || '-' || SUBSTR(MAX(UP2),5,2) || '-' || SUBSTR(MAX(UP2),7,2) || ' ' || SUBSTR(MAX(UP2),9,2) || ':' || SUBSTR(MAX(UP2),11,2) || ':' || SUBSTR(MAX(UP2),13,2) itemFrstRegistDt
            , SUBSTR(MAX(UP3),1,4) || '-' || SUBSTR(MAX(UP3),5,2) || '-' || SUBSTR(MAX(UP3),7,2) || ' ' || SUBSTR(MAX(UP3),9,2) || ':' || SUBSTR(MAX(UP3),11,2) || ':' || SUBSTR(MAX(UP3),13,2) billFrstRegistDt
            , SUBSTR(MAX(UP4),1,4) || '-' || SUBSTR(MAX(UP4),5,2) || '-' || SUBSTR(MAX(UP4),7,2) || ' ' || SUBSTR(MAX(UP4),9,2) || ':' || SUBSTR(MAX(UP4),11,2) || ':' || SUBSTR(MAX(UP4),13,2) minutesAppendixFrstRegistDt
            , SUBSTR(MAX(UP5),1,4) || '-' || SUBSTR(MAX(UP5),5,2) || '-' || SUBSTR(MAX(UP5),7,2) || ' ' || SUBSTR(MAX(UP5),9,2) || ':' || SUBSTR(MAX(UP5),11,2) || ':' || SUBSTR(MAX(UP5),13,2) billFrstRegistDt
            , SUBSTR(MAX(UP6),1,4) || '-' || SUBSTR(MAX(UP6),5,2) || '-' || SUBSTR(MAX(UP6),7,2) || ' ' || SUBSTR(MAX(UP6),9,2) || ':' || SUBSTR(MAX(UP6),11,2) || ':' || SUBSTR(MAX(UP6),13,2) minutesStatementFrstRegistDt
            , CC.RASMBLY_ID rasmblyNmNo
        FROM (
            SELECT AA.RASMBLY_ID, UP1, UP2, UP3, UP4, UP5, UP6 FROM
               (SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP1  FROM MINUTES GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) AA
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP2 FROM ITEM GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) BB
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP3 FROM MINUTES_ANSWER GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) CC
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP4 FROM MINUTES_APPENDIX GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) DD
              ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP5 FROM BILL GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) EE
        	  ,(SELECT RASMBLY_ID, MAX(LAST_UPDT_DT) UP6 FROM MINUTES_STATEMENT GROUP BY RASMBLY_ID ORDER BY RASMBLY_ID ASC) FF
                WHERE AA.RASMBLY_ID = BB.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = CC.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = DD.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = EE.RASMBLY_ID(+)
                AND AA.RASMBLY_ID = FF.RASMBLY_ID(+)
            ) BB, COLGOVER CC WHERE 1 = 1
		]]>
        <if test="keyWordSub == 1"> <!-- 기관유형 -->
            <if test="brtcCode == 'intsttcl_000024'"> <!-- 기초 -->
                AND SUBSTR(CC.RASMBLY_ID,1,6) IN (
                SELECT LOASM_CODE AS LOASMCODE
                FROM ORGAN, COLGOVER
                WHERE INSTT_CL_CODE = 'INTSTTCL_000024'
                AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
            <if test="brtcCode == 'intsttcl_000023'"> <!-- 광역 -->
                AND SUBSTR(CC.RASMBLY_ID,1,6) IN (
                SELECT LOASM_CODE AS LOASMCODE
                FROM ORGAN, COLGOVER
                WHERE INSTT_CL_CODE != 'INTSTTCL_000024'
                AND ORGAN.LOASM_CODE = COLGOVER.RASMBLY_ID
                )
            </if>
        </if>
        <if test="keyWordSub == 2"> <!-- 지역 -->
            AND CC.RASMBLY_ID LIKE #{insttClCode} || '%'
        </if>
        <if test="keyWordSub == 3"> <!-- 지방의회 -->
            AND CC.RASMBLY_ID = #{loasmCode}
        </if>
        GROUP BY CC.RASMBLY_ID,CC.ORDR	ORDER BY CC.ORDR ASC
    </select>


</mapper>
